(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mine/avatar/index"],{56:function(t,e,a){"use strict";(function(t){a(5);c(a(4));var e=c(a(57));function c(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=a,t(e.default)}).call(this,a(1)["createPage"])},57:function(t,e,a){"use strict";a.r(e);var c=a(58),r=a(60);for(var n in r)"default"!==n&&function(t){a.d(e,t,(function(){return r[t]}))}(n);a(64);var i,u=a(24),s=Object(u["default"])(r["default"],c["render"],c["staticRenderFns"],!1,null,null,null,!1,c["components"],i);s.options.__file="pages/mine/avatar/index.vue",e["default"]=s.exports},58:function(t,e,a){"use strict";a.r(e);var c=a(59);a.d(e,"render",(function(){return c["render"]})),a.d(e,"staticRenderFns",(function(){return c["staticRenderFns"]})),a.d(e,"recyclableRender",(function(){return c["recyclableRender"]})),a.d(e,"components",(function(){return c["components"]}))},59:function(t,e,a){"use strict";var c;a.r(e),a.d(e,"render",(function(){return r})),a.d(e,"staticRenderFns",(function(){return i})),a.d(e,"recyclableRender",(function(){return n})),a.d(e,"components",(function(){return c}));var r=function(){var t=this,e=t.$createElement;t._self._c},n=!1,i=[];r._withStripped=!0},60:function(t,e,a){"use strict";a.r(e);var c=a(61),r=a.n(c);for(var n in c)"default"!==n&&function(t){a.d(e,t,(function(){return c[t]}))}(n);e["default"]=r.a},61:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c=i(a(9)),r=i(a(10)),n=a(62);function i(t){return t&&t.__esModule?t:{default:t}}var u,s,o,h,p,d,f,l,g,v,m,R=c.default.baseUrl,T=t.getSystemInfoSync(),_=T.screenWidth,b=(T.pixelRatio,1),L=100,I=T.screenWidth,W={data:function(){return{imageSrc:r.default.getters.avatar,isShowImg:!1,cropperInitW:_,cropperInitH:_,cropperW:_,cropperH:_,cropperL:0,cropperT:0,transL:0,transT:0,scaleP:0,imageW:0,imageH:0,cutL:0,cutT:0,cutB:_,cutR:"100%",qualityWidth:I,innerAspectRadio:b}},onReady:function(){this.loadImage()},methods:{setData:function(t){var e=this;Object.keys(t).forEach((function(a){e.$set(e.$data,a,t[a])}))},getImage:function(){var e=this;t.chooseImage({success:function(t){e.setData({imageSrc:t.tempFilePaths[0]}),e.loadImage()}})},loadImage:function(){var e=this;t.getImageInfo({src:e.imageSrc,success:function(a){g=1,g>=1?(v=_,m=_/g):(v=_*g,m=_);var c=v>m?v:m;if(L=c>L?L:c,g>=1){var r=Math.ceil((_/g-(_/g-L))/2),n=r,i=Math.ceil((_-_+L)/2),u=i;e.setData({cropperW:_,cropperH:_/g,cropperL:Math.ceil((_-_)/2),cropperT:Math.ceil((_-_/g)/2),cutL:i,cutT:r,cutR:u,cutB:n,imageW:v,imageH:m,scaleP:v/_,qualityWidth:I,innerAspectRadio:g})}else{var s=Math.ceil((_*g-_*g)/2),o=s,h=Math.ceil((_-L)/2),p=h;e.setData({cropperW:_*g,cropperH:_,cropperL:Math.ceil((_-_*g)/2),cropperT:Math.ceil((_-_)/2),cutL:s,cutT:h,cutR:o,cutB:p,imageW:v,imageH:m,scaleP:v/_,qualityWidth:I,innerAspectRadio:g})}e.setData({isShowImg:!0}),t.hideLoading()}})},contentStartMove:function(t){u=t.touches[0].pageX,s=t.touches[0].pageY},contentMoveing:function(t){var e=(u-t.touches[0].pageX)*b,a=(s-t.touches[0].pageY)*b;e>0?this.cutL-e<0&&(e=this.cutL):this.cutR+e<0&&(e=-this.cutR),a>0?this.cutT-a<0&&(a=this.cutT):this.cutB+a<0&&(a=-this.cutB),this.setData({cutL:this.cutL-e,cutT:this.cutT-a,cutR:this.cutR+e,cutB:this.cutB+a}),u=t.touches[0].pageX,s=t.touches[0].pageY},contentTouchEnd:function(){},getImageInfo:function(){var e=this;t.showLoading({title:"图片生成中..."});var a=t.createCanvasContext("myCanvas");a.drawImage(e.imageSrc,0,0,v,m),a.draw(!0,(function(){var a=(e.cropperW-e.cutL-e.cutR)/e.cropperW*v,c=(e.cropperH-e.cutT-e.cutB)/e.cropperH*m,i=e.cutL/e.cropperW*v,u=e.cutT/e.cropperH*m;t.canvasToTempFilePath({x:i,y:u,width:a,height:c,destWidth:a,destHeight:c,quality:.5,canvasId:"myCanvas",success:function(e){t.hideLoading();var a={name:"avatarfile",filePath:e.tempFilePath};(0,n.uploadAvatar)(a).then((function(e){r.default.commit("SET_AVATAR",R+e.imgUrl),t.showToast({title:"修改成功",icon:"success"}),t.navigateBack()}))}})}))},dragStart:function(t){o=t.touches[0].pageX,h=t.touches[0].pageY,p=this.cutL,f=this.cutR,l=this.cutB,d=this.cutT},dragMove:function(t){var e=t.target.dataset.drag;switch(e){case"right":var a=(o-t.touches[0].pageX)*b;f+a<0&&(a=-f),this.setData({cutR:f+a});break;case"left":a=(o-t.touches[0].pageX)*b;p-a<0&&(a=p),p-a>this.cropperW-this.cutR&&(a=p-(this.cropperW-this.cutR)),this.setData({cutL:p-a});break;case"top":a=(h-t.touches[0].pageY)*b;d-a<0&&(a=d),d-a>this.cropperH-this.cutB&&(a=d-(this.cropperH-this.cutB)),this.setData({cutT:d-a});break;case"bottom":a=(h-t.touches[0].pageY)*b;l+a<0&&(a=-l),this.setData({cutB:l+a});break;case"rightBottom":var c=(o-t.touches[0].pageX)*b,r=(h-t.touches[0].pageY)*b;l+r<0&&(r=-l),f+c<0&&(c=-f);var n=l+r,i=f+c;this.setData({cutB:n,cutR:i});break;default:break}}}};e.default=W}).call(this,a(1)["default"])},64:function(t,e,a){"use strict";a.r(e);var c=a(65),r=a.n(c);for(var n in c)"default"!==n&&function(t){a.d(e,t,(function(){return c[t]}))}(n);e["default"]=r.a},65:function(t,e,a){}},[[56,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/mine/avatar/index.js.map