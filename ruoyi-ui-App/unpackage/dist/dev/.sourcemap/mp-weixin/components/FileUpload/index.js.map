{"version":3,"sources":["webpack:///E:/WorkSpace/暂未上线/DongYi-业务流程-Flowable/dongyi-ui-App/components/FileUpload/index.vue?0f52","webpack:///E:/WorkSpace/暂未上线/DongYi-业务流程-Flowable/dongyi-ui-App/components/FileUpload/index.vue?7090","webpack:///E:/WorkSpace/暂未上线/DongYi-业务流程-Flowable/dongyi-ui-App/components/FileUpload/index.vue?e0a2","webpack:///E:/WorkSpace/暂未上线/DongYi-业务流程-Flowable/dongyi-ui-App/components/FileUpload/index.vue?6d81","uni-app:///components/FileUpload/index.vue","webpack:///E:/WorkSpace/暂未上线/DongYi-业务流程-Flowable/dongyi-ui-App/components/FileUpload/index.vue?ce09"],"names":["renderjs","component","options","__file","components","uniFilePicker","uniPopup","uniPopupMessage","uniPopupDialog","e","message","indexOf","console","error","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped","name","props","ossIds","String","Object","Array","limit","type","Number","default","fileSize","data","watch","deep","immediate","computed","methods","handleDelete","handleDownload","$download","oss","ossId","getFileName","lastIndexOf","slice","listToString","separator","strs","list","i","fileId","substr","length"],"mappings":"4HAAA,yHACIA,EADJ,QASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,WACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,kCACZ,aAAAF,E,0CCvBf,uQ,iCCAA,IAAIG,EAAJ,0LACA,IACEA,EAAa,CACXC,cAAe,WACb,OAAO,0IAITC,SAAU,WACR,OAAO,oFAITC,gBAAiB,WACf,OAAO,wIAITC,eAAgB,WACd,OAAO,uIAKX,MAAOC,GACP,IAC+C,IAA7CA,EAAEC,QAAQC,QAAQ,wBACa,IAA/BF,EAAEC,QAAQC,QAAQ,QAWlB,MAAMF,EATNG,QAAQC,MAAMJ,EAAEC,SAChBE,QAAQC,MAAM,mBACdD,QAAQC,MACN,uFAEFD,QAAQC,MACN,mDAMN,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,IAEjBC,GAAmB,EACnBC,EAAkB,GACtBR,EAAOS,eAAgB,G,iCChDvB,8GAAsyB,eAAG,G,gIC6BzyB,QACA,S,qXAEA,CACEC,KAAM,aACNC,MAAO,CAELC,OAAQ,CAACC,OAAQC,OAAQC,OAEzBC,MAAO,CACLC,KAAMC,OACNC,QAAS,GAGXC,SAAU,CACRH,KAAMC,OACNC,QAAS,KAGf,UACA,WACA,2FAGEE,KArBF,WAsBI,MAAO,CACX,SACA,2CACA,sEACA,UACA,0CAEA,SACA,sCAGA,cACA,YAGA,WACA,eAEA,aACA,gBAEA,kBAGEC,MAAO,CACLV,OAAQ,CACN,QADN,SACA,sIACA,EADA,oBAEA,GAGA,iBALA,gBAMA,IANA,uCAQA,oCACA,eACA,0BAEA,OADA,iDACA,QAZA,OAiBA,8BAGA,OAFA,iGACA,cACA,KApBA,+BAuBA,cAvBA,kBAwBA,IAxBA,+CA2BMW,MAAM,EACNC,WAAW,IAGfC,SAAU,GAEVC,QAAS,CACX,aADA,SACA,kIACA,EACA,kBACA,cACA,oBACA,cACA,YACA,UACA,0CAEA,SACA,sCAEA,oBACA,yBACA,oBACA,kBACA,uBACA,wBAEA,cACA,6EACA,2CACA,4CACA,oBACA,oBACA,yBAEA,kBACA,oBACA,2BA9BA,8CAqCIC,aAtCJ,SAsCA,GACA,2BACM,IAAN,oBACA,gBACA,sBACA,iDACA,+BAGA,cA/CA,WAgDA,iBACA,kDAEA,qCACA,sDAGA,YAvDA,WAwDA,oCACA,2CACA,4BAGIC,eA7DJ,SA6DA,GACM,IAAN,yBACM1B,KAAK2B,UAAUC,IAAIC,IAIrBC,YAnEJ,SAmEA,GAEM,OAAItB,EAAKuB,YAAY,MAAQ,EACpBvB,EAAKwB,MAAMxB,EAAKuB,YAAY,KAAO,GAEnCvB,GAIXyB,aA5EJ,SA4EA,KACM,IAAN,KAEM,IAAK,IAAX,KADMC,EAAYA,GAAa,IAC/B,EACQC,GAAQC,EAAKC,GAAGC,OAASJ,EAE3B,MAAe,IAARC,EAAaA,EAAKI,OAAO,EAAGJ,EAAKK,OAAS,GAAK,M,2ECnM5D,8GAAy/C,eAAG,G","file":"components/FileUpload/index.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=3e530c3b&scoped=true&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=3e530c3b&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3e530c3b\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/FileUpload/index.vue\"\nexport default component.exports","export * from \"-!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=template&id=3e530c3b&scoped=true&\"","var components\ntry {\n  components = {\n    uniFilePicker: function() {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker\" */ \"@/uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.vue\"\n      )\n    },\n    uniPopup: function() {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-popup/components/uni-popup/uni-popup\" */ \"@/uni_modules/uni-popup/components/uni-popup/uni-popup.vue\"\n      )\n    },\n    uniPopupMessage: function() {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-popup/components/uni-popup-message/uni-popup-message\" */ \"@/uni_modules/uni-popup/components/uni-popup-message/uni-popup-message.vue\"\n      )\n    },\n    uniPopupDialog: function() {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog\" */ \"@/uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.vue\"\n      )\n    }\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=script&lang=js&\"","<template>\r\n  <view>\r\n\t<div class=\"upload-file\">\r\n\t\t<uni-file-picker \r\n\t\t\tv-model=\"fileList\"\r\n\t\t\tfile-mediatype=\"all\"\r\n\t\t\t:auto-upload=\"false\"\r\n\t\t\t:limit=\"limit\"\r\n\t\t\t@progress=\"progress\" \r\n\t\t\t@success=\"handleUploadSuccess\" \r\n\t\t\t@fail=\"handleUploadError\" \r\n\t\t\t@select=\"handleSelect\"\r\n\t\t\t@delete=\"handleDelete\"\r\n\t\t/>\r\n\t</div>\r\n\r\n\t<!-- 提示信息弹窗 -->\r\n\t<uni-popup ref=\"message\" type=\"message\">\r\n\t\t<uni-popup-message :type=\"msgType\" :message=\"messageText\" :duration=\"2000\"></uni-popup-message>\r\n\t</uni-popup>\r\n\t<!-- 提示窗 -->\r\n\t<uni-popup ref=\"alertDialog\" type=\"dialog\">\r\n\t\t<uni-popup-dialog :type=\"alertType\" cancelText=\"取消\" confirmText=\"确认\" title=\"提示\" :content=\"alertContent\" @confirm=\"dialogConfirm\"\r\n\t\t\t@close=\"dialogClose\"></uni-popup-dialog>\r\n\t</uni-popup>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { getToken } from \"@/utils/auth\";\r\nimport { listByIds,delOss } from \"@/api/system/oss\";\r\n\r\nexport default {\r\n  name: \"FileUpload\",\r\n  props: {\r\n    // 值\r\n    ossIds: [String, Object, Array],\r\n    // 数量限制\r\n    limit: {\r\n      type: Number,\r\n      default: 5,\r\n    },\r\n    // 大小限制(MB)\r\n    fileSize: {\r\n      type: Number,\r\n      default: 150,\r\n    },\r\n\t// 文件类型\r\n\tfileType: {\r\n\t  type: Array,\r\n\t  default: () => [\"doc\", \"xls\", \"ppt\", \"txt\", \"pdf\",\"zip\",\"rar\",'png', 'jpg', 'jpeg'],\r\n\t},\r\n  },\r\n  data() {\r\n    return {\r\n\t\tnumber: 0,\r\n\t\tbaseUrl: getApp().globalData.config.baseUrl,\r\n\t\tuploadFileUrl: getApp().globalData.config.baseUrl + \"/system/oss/upload\", // 上传的图片服务器地址\r\n\t\tformData:{\r\n\t\t\tAuthorization: \"Bearer \" + getToken(),\r\n\t\t},\r\n\t\theaders: {\r\n\t\t\t'content-type': 'multipart/form-data'\r\n\t\t},\r\n\t\t//上传列表\r\n\t\tuploadList:[],\r\n\t\tfileList: [],\r\n\t\r\n\t\t// 消息提示窗口、提示框\r\n\t\tmsgType: '',\r\n\t\tmessageText: '',\r\n\t\t// 弹出框\r\n\t\talertType:'',\r\n\t\talertContent:'',\r\n\t\t//待删除对象\r\n\t\ttempItem:undefined,\r\n    };\r\n  },\r\n  watch: {\r\n    ossIds: {\r\n      async handler(val) {\r\n        if (val) {\r\n          let temp = 1;\r\n          // 首先将值转为数组\r\n          let list;\r\n          if (Array.isArray(val)) {\r\n            list = val;\r\n          } else {\r\n            await listByIds(val).then(res => {\r\n\t\t\t\tconsole.log(res)\r\n              list = res.data.map(oss => {\r\n                oss = { name: oss.originalName, url: oss.url, fileId: oss.ossId };\r\n                return oss;\r\n              });\r\n            })\r\n          }\r\n          // 然后将数组转为对象数组\r\n          this.fileList = list.map(item => {\r\n            item = { name: item.name, url: item.url, fileId: item.ossId,extname:undefined,fileType:undefined,image:undefined,size:undefined  };\r\n            item.path = item.path;\r\n            return item;\r\n          });\r\n        } else {\r\n          this.fileList = [];\r\n          return [];\r\n        }\r\n      },\r\n      deep: true,\r\n      immediate: true\r\n    }\r\n  },\r\n  computed: {\r\n  },\r\n  methods: {\r\n\tasync handleSelect(res){// 上传\r\n\t  const app = this\r\n\t  const tempFilePaths = res.tempFilePaths;\r\n\t  uni.uploadFile({\r\n\t\turl: this.uploadFileUrl,\r\n\t\tfilePath: tempFilePaths[0],\r\n\t\tname: 'file',\r\n\t\tformData:{\r\n\t\t\tAuthorization: \"Bearer \" + getToken(),\r\n\t\t},\r\n\t\theaders: {\r\n\t\t\t'content-type': 'multipart/form-data'\r\n\t\t},\r\n\t\tsuccess: (res) => {\r\n\t\t\tconst resData = JSON.parse(res.data)\r\n\t\t\tif(res.statusCode != 200 ){\r\n\t\t\t\tthis.msgType = 'error'\r\n\t\t\t\tthis.messageText = res.errMsg\r\n\t\t\t\tthis.$refs.message.open()\r\n\t\t\t}\r\n\t\t\tif (resData.code === 200) {\r\n\t\t\t\tthis.uploadList.push({ name: resData.data.fileName, url: resData.data.url, fileId: resData.data.ossId });\r\n\t\t\t\tthis.fileList = this.fileList.concat(this.uploadList);\r\n\t\t\t\tthis.$emit(\"input\", this.listToString(this.fileList));\r\n\t\t\t\tthis.msgType = 'success'\r\n\t\t\t\tthis.messageText = resData.msg\r\n\t\t\t\tthis.$refs.message.open()\r\n\t\t\t} else {\r\n\t\t\t\tthis.msgType = 'error'\r\n\t\t\t\tthis.messageText = resData.msg\r\n\t\t\t\tthis.$refs.message.open()\r\n\t\t\t}\r\n\t\t}\r\n\t  });\r\n\t},\r\n\r\n    // 删除文件\r\n    handleDelete(item) {\r\n\t  console.log(this.fileList)\r\n      let ossId = item.tempFile.fileId;\r\n\t  this.tempItem = item;\r\n\t  this.alertType = 'warn'\r\n\t  this.alertContent ='是否确认删除OSS对象存储编号为\"' + ossId + '\"的数据项?'\r\n\t  this.$refs.alertDialog.open()\r\n    },\r\n\t// 确认删除\r\n\tdialogConfirm(){\r\n\t\tif(this.tempItem){\r\n\t\t\treturn delOss(this.tempItem.tempFile.fileId);\r\n\t\t}\r\n\t\tthis.fileList.$remove(this.tempItem)\r\n\t\tthis.$emit(\"input\", this.listToString(this.fileList));\r\n\t},\r\n\t// 取消删除\r\n\tdialogClose(){\r\n\t\tconsole.log(this.tempItem.tempFile)\r\n\t\tthis.fileList.push(this.tempItem.tempFile)\r\n\t\tconsole.log(this.fileList)\r\n\t},\r\n    /** 下载文件 */\r\n    handleDownload(index) {\r\n      let ossId = this.fileList[index].ossId;\r\n      this.$download.oss(ossId)\r\n    },\r\n\r\n    // 获取文件名称\r\n    getFileName(name) {\r\n      // 如果是url那么取最后的名字 如果不是直接返回\r\n      if (name.lastIndexOf(\"/\") > -1) {\r\n        return name.slice(name.lastIndexOf(\"/\") + 1);\r\n      } else {\r\n        return name;\r\n      }\r\n    },\r\n    // 对象转成指定字符串分隔\r\n    listToString(list, separator) {\r\n      let strs = \"\";\r\n      separator = separator || \",\";\r\n      for (let i in list) {\r\n        strs += list[i].fileId + separator;\r\n      }\r\n      return strs != \"\" ? strs.substr(0, strs.length - 1) : \"\";\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.upload-file-uploader {\r\n  margin-bottom: 5px;\r\n}\r\n.upload-file-list .el-upload-list__item {\r\n  border: 1px solid #e4e7ed;\r\n  line-height: 2;\r\n  margin-bottom: 10px;\r\n  position: relative;\r\n}\r\n.upload-file-list .ele-upload-list__item-content {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  color: inherit;\r\n}\r\n.ele-upload-list__item-content-action .el-link {\r\n  margin-right: 10px;\r\n}\r\n</style>\r\n","import mod from \"-!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&id=3e530c3b&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../devTools/HBuilderX.3.1.22.20210709.full/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./index.vue?vue&type=style&index=0&id=3e530c3b&scoped=true&lang=scss&\""],"sourceRoot":""}